{
  "openapi": "3.0.3",
  "info": {
    "title": "API Banque",
    "description": "API REST pour système bancaire avec Laravel 10",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://127.0.0.1:8000/api/v1",
      "description": "Serveur de développement"
    },
    {
      "url": "https://api.banque.example.com/api/v1",
      "description": "Serveur de production"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/auth/login": {
      "post": {
        "tags": ["Authentification"],
        "summary": "Connexion utilisateur",
        "description": "Connexion avec vérification de code pour première connexion",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "amadou.diallo@example.com"
                  },
                  "password": {
                    "type": "string",
                    "example": "password123"
                  },
                  "code": {
                    "type": "string",
                    "example": "ABC123",
                    "description": "Requis pour première connexion"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Connexion réussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Connexion réussie"},
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "type": "object",
                          "properties": {
                            "id": {"type": "string", "format": "uuid"},
                            "titulaire": {"type": "string", "example": "Amadou Diallo"},
                            "email": {"type": "string", "format": "email"},
                            "telephone": {"type": "string"}
                          }
                        },
                        "access_token": {"type": "string", "example": "1|abc123..."},
                        "token_type": {"type": "string", "example": "Bearer"},
                        "expires_in": {"type": "integer", "example": 3600}
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Identifiants invalides"
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": ["Authentification"],
        "summary": "Rafraîchir le token",
        "description": "Renouvelle le token d'accès",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Token rafraîchi",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Token rafraîchi"},
                    "data": {
                      "type": "object",
                      "properties": {
                        "access_token": {"type": "string"},
                        "token_type": {"type": "string", "example": "Bearer"},
                        "expires_in": {"type": "integer", "example": 3600}
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Authentification"],
        "summary": "Déconnexion",
        "description": "Invalide le token actuel",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Déconnexion réussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Déconnexion réussie"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "/comptes": {
      "get": {
        "tags": ["Comptes"],
        "summary": "Lister tous les comptes",
        "description": "Admin voit tous les comptes, Client voit ses comptes uniquement",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {"type": "integer", "default": 1},
            "description": "Numéro de page"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {"type": "integer", "default": 10, "maximum": 100},
            "description": "Éléments par page"
          },
          {
            "name": "type",
            "in": "query",
            "schema": {"type": "string", "enum": ["epargne", "cheque"]},
            "description": "Filtrer par type"
          },
          {
            "name": "statut",
            "in": "query",
            "schema": {"type": "string", "enum": ["actif", "bloque", "ferme"]},
            "description": "Filtrer par statut"
          },
          {
            "name": "search",
            "in": "query",
            "schema": {"type": "string"},
            "description": "Recherche par titulaire ou numéro"
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {"type": "string", "enum": ["dateCreation", "solde", "titulaire"]},
            "description": "Champ de tri"
          },
          {
            "name": "order",
            "in": "query",
            "schema": {"type": "string", "enum": ["asc", "desc"]},
            "description": "Ordre de tri"
          }
        ],
        "responses": {
          "200": {
            "description": "Liste des comptes récupérée",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "data": {
                      "type": "array",
                      "items": {"$ref": "#/components/schemas/Compte"}
                    },
                    "pagination": {"$ref": "#/components/schemas/Pagination"},
                    "links": {"$ref": "#/components/schemas/Links"}
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Comptes"],
        "summary": "Créer un nouveau compte",
        "description": "Créer un compte avec génération automatique de numéro",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["type", "soldeInitial", "devise"],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["cheque", "epargne"],
                    "example": "cheque"
                  },
                  "soldeInitial": {
                    "type": "number",
                    "minimum": 10000,
                    "example": 500000
                  },
                  "devise": {
                    "type": "string",
                    "example": "FCFA"
                  },
                  "client": {
                    "type": "object",
                    "properties": {
                      "id": {"type": "string", "format": "uuid", "nullable": true},
                      "titulaire": {"type": "string", "example": "Nouveau Client"},
                      "email": {"type": "string", "format": "email"},
                      "telephone": {"type": "string"},
                      "adresse": {"type": "string"}
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Compte créé avec succès",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Compte créé avec succès"},
                    "data": {"$ref": "#/components/schemas/Compte"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "/comptes/{compteId}": {
      "get": {
        "tags": ["Comptes"],
        "summary": "Récupérer un compte spécifique",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "compteId",
            "in": "path",
            "required": true,
            "schema": {"type": "string", "format": "uuid"}
          }
        ],
        "responses": {
          "200": {
            "description": "Compte récupéré",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "data": {"$ref": "#/components/schemas/Compte"}
                  }
                }
              }
            }
          },
          "404": {
            "description": "Compte non trouvé"
          }
        }
      },
      "patch": {
        "tags": ["Comptes"],
        "summary": "Mettre à jour les informations client",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "compteId",
            "in": "path",
            "required": true,
            "schema": {"type": "string", "format": "uuid"}
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "titulaire": {"type": "string"},
                  "informationsClient": {
                    "type": "object",
                    "properties": {
                      "telephone": {"type": "string"},
                      "email": {"type": "string", "format": "email"},
                      "password": {"type": "string"},
                      "nci": {"type": "string"}
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Compte mis à jour",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Compte mis à jour avec succès"},
                    "data": {"$ref": "#/components/schemas/Compte"}
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Comptes"],
        "summary": "Supprimer un compte",
        "description": "Suppression logique (soft delete)",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "compteId",
            "in": "path",
            "required": true,
            "schema": {"type": "string", "format": "uuid"}
          }
        ],
        "responses": {
          "200": {
            "description": "Compte supprimé",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Compte supprimé avec succès"},
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {"type": "string", "format": "uuid"},
                        "numeroCompte": {"type": "string"},
                        "statut": {"type": "string", "example": "ferme"},
                        "dateFermeture": {"type": "string", "format": "date-time"}
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/comptes/{compteId}/bloquer": {
      "post": {
        "tags": ["Comptes"],
        "summary": "Bloquer un compte",
        "description": "Bloquer un compte épargne actif",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "compteId",
            "in": "path",
            "required": true,
            "schema": {"type": "string", "format": "uuid"}
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["motif", "duree", "unite"],
                "properties": {
                  "motif": {"type": "string", "example": "Activité suspecte détectée"},
                  "duree": {"type": "integer", "example": 30},
                  "unite": {"type": "string", "enum": ["jours", "mois"], "example": "mois"}
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Compte bloqué",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Compte bloqué avec succès"},
                    "data": {"$ref": "#/components/schemas/Compte"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "/comptes/{compteId}/debloquer": {
      "post": {
        "tags": ["Comptes"],
        "summary": "Débloquer un compte",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "compteId",
            "in": "path",
            "required": true,
            "schema": {"type": "string", "format": "uuid"}
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["motif"],
                "properties": {
                  "motif": {"type": "string", "example": "Vérification complétée"}
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Compte débloqué",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean", "example": true},
                    "message": {"type": "string", "example": "Compte débloqué avec succès"},
                    "data": {"$ref": "#/components/schemas/Compte"}
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Compte": {
        "type": "object",
        "properties": {
          "id": {"type": "string", "format": "uuid", "example": "550e8400-e29b-41d4-a716-446655440000"},
          "numeroCompte": {"type": "string", "example": "C00123456"},
          "titulaire": {"type": "string", "example": "Amadou Diallo"},
          "type": {"type": "string", "enum": ["epargne", "cheque"], "example": "epargne"},
          "solde": {"type": "number", "example": 1250000},
          "devise": {"type": "string", "example": "FCFA"},
          "dateCreation": {"type": "string", "format": "date-time"},
          "statut": {"type": "string", "enum": ["actif", "bloque", "ferme"], "example": "bloque"},
          "motifBlocage": {"type": "string", "nullable": true},
          "dateDebutBlocage": {"type": "string", "format": "date-time", "nullable": true},
          "dateFinBlocage": {"type": "string", "format": "date-time", "nullable": true},
          "metadata": {
            "type": "object",
            "properties": {
              "derniereModification": {"type": "string", "format": "date-time"},
              "version": {"type": "integer", "example": 1}
            }
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "currentPage": {"type": "integer", "example": 1},
          "totalPages": {"type": "integer", "example": 6},
          "totalItems": {"type": "integer", "example": 58},
          "itemsPerPage": {"type": "integer", "example": 10},
          "hasNext": {"type": "boolean", "example": true},
          "hasPrevious": {"type": "boolean", "example": false}
        }
      },
      "Links": {
        "type": "object",
        "properties": {
          "self": {"type": "string", "example": "/api/v1/comptes?page=1&limit=10"},
          "first": {"type": "string", "example": "/api/v1/comptes?page=1&limit=10"},
          "last": {"type": "string", "example": "/api/v1/comptes?page=6&limit=10"},
          "next": {"type": "string", "example": "/api/v1/comptes?page=2&limit=10", "nullable": true},
          "prev": {"type": "string", "nullable": true}
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "tags": [
    {"name": "Authentification", "description": "Endpoints d'authentification"},
    {"name": "Comptes", "description": "Gestion des comptes bancaires"}
  ]
}